<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Minesweeper</title>
  <style>
    body {
      background: #222;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }
    h1 {
      margin-top: 20px;
    }
    #game {
      display: inline-block;
      margin-top: 20px;
    }
    .row {
      display: flex;
    }
    .cell {
      width: 30px;
      height: 30px;
      border: 1px solid #555;
      background: #333;
      font-size: 18px;
      line-height: 30px;
      text-align: center;
      user-select: none;
      cursor: pointer;
    }
    .revealed {
      background: #777;
      cursor: default;
    }
    .mine {
      background: red;
    }
    .flag {
      background: orange;
    }
    #status {
      margin-top: 15px;
      font-size: 20px;
    }
    button {
      margin-top: 10px;
      padding: 5px 10px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>Minesweeper</h1>
  <div>
    <label>Rows: <input type="number" id="rows" value="10" min="5" max="20" /></label>
    <label>Cols: <input type="number" id="cols" value="10" min="5" max="20" /></label>
    <label>Mines: <input type="number" id="mines" value="10" min="1" max="100" /></label>
    <button onclick="startGame()">Start Game</button>
  </div>
  <div id="status"></div>
  <div id="game"></div>

  <script>
    let board = [];
    let rows = 10;
    let cols = 10;
    let mineCount = 10;
    let gameOver = false;

    function startGame() {
      rows = parseInt(document.getElementById('rows').value);
      cols = parseInt(document.getElementById('cols').value);
      mineCount = parseInt(document.getElementById('mines').value);
      gameOver = false;
      board = [];
      document.getElementById('status').textContent = '';
      const game = document.getElementById('game');
      game.innerHTML = '';

      // Initialize board
      for (let y = 0; y < rows; y++) {
        let row = [];
        const rowDiv = document.createElement('div');
        rowDiv.className = 'row';
        for (let x = 0; x < cols; x++) {
          const cell = {
            x, y,
            mine: false,
            revealed: false,
            flagged: false,
            element: document.createElement('div'),
            adjacentMines: 0
          };
          cell.element.className = 'cell';
          cell.element.oncontextmenu = (e) => {
            e.preventDefault();
            if (gameOver || cell.revealed) return;
            cell.flagged = !cell.flagged;
            cell.element.className = 'cell' + (cell.flagged ? ' flag' : '');
            checkWin();
          };
          cell.element.onclick = () => {
            if (gameOver || cell.flagged) return;
            revealCell(cell);
            checkWin();
          };
          row.push(cell);
          rowDiv.appendChild(cell.element);
        }
        board.push(row);
        game.appendChild(rowDiv);
      }

      // Place mines
      let minesPlaced = 0;
      while (minesPlaced < mineCount) {
        let rx = Math.floor(Math.random() * cols);
        let ry = Math.floor(Math.random() * rows);
        if (!board[ry][rx].mine) {
          board[ry][rx].mine = true;
          minesPlaced++;
        }
      }

      // Calculate adjacent mine numbers
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          let cell = board[y][x];
          if (cell.mine) continue;
          cell.adjacentMines = getNeighbors(x, y).filter(n => n.mine).length;
        }
      }
    }

    function getNeighbors(x, y) {
      const neighbors = [];
      for (let dx = -1; dx <= 1; dx++) {
        for (let dy = -1; dy <= 1; dy++) {
          if (dx === 0 && dy === 0) continue;
          let nx = x + dx;
          let ny = y + dy;
          if (nx >= 0 && nx < cols && ny >= 0 && ny < rows) {
            neighbors.push(board[ny][nx]);
          }
        }
      }
      return neighbors;
    }

    function revealCell(cell) {
      if (cell.revealed || cell.flagged) return;
      cell.revealed = true;
      cell.element.className = 'cell revealed';
      if (cell.mine) {
        cell.element.classList.add('mine');
        cell.element.textContent = 'ðŸ’£';
        endGame(false);
        return;
      }
      if (cell.adjacentMines > 0) {
        cell.element.textContent = cell.adjacentMines;
      } else {
        getNeighbors(cell.x, cell.y).forEach(revealCell);
      }
    }

    function endGame(won) {
      gameOver = true;
      document.getElementById('status').textContent = won ? 'ðŸŽ‰ You Win!' : 'ðŸ’¥ Game Over!';
      // Reveal all mines
      for (let row of board) {
        for (let cell of row) {
          if (cell.mine) {
            cell.element.className = 'cell revealed mine';
            cell.element.textContent = 'ðŸ’£';
          }
        }
      }
    }

    function checkWin() {
      let unrevealed = 0;
      for (let row of board) {
        for (let cell of row) {
          if (!cell.revealed && !cell.mine) unrevealed++;
        }
      }
      if (unrevealed === 0) {
        endGame(true);
      }
    }

    // Start game on load
    window.onload = startGame;
  </script>
</body>
</html>
